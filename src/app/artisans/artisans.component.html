<app-header></app-header>
<app-sidebar></app-sidebar>
<p-toast></p-toast>

<div class="page-wrapper">
  <div class="content">
    <div class="page-header">
      <div class="add-item d-flex">
        <div class="page-title">
          <h4 class="fw-bold">Artisans </h4>
          <h6>Gérez vos artisans </h6>
        </div>
      </div>
      <ul class="table-top-head">
        <li>
          <a (click)="exportPdf()" data-bs-toggle="tooltip" data-bs-placement="top" title="Pdf"><img src="assets/img/icons/pdf.svg" alt="img"></a>
        </li>
        <li>
          <a (click)="exportExcel()" data-bs-toggle="tooltip" data-bs-placement="top" title="Excel"><img src="assets/img/icons/excel.svg" alt="img"></a>
        </li>
        <li>
          <a (click)="refresh()" data-bs-toggle="tooltip" data-bs-placement="top" title="Refresh"><i class="ti ti-refresh"></i></a>
        </li>
        <li>
          <a data-bs-toggle="tooltip" data-bs-placement="top" title="Collapse" id="collapse-header"><i class="ti ti-chevron-up"></i></a>
        </li>
      </ul>
      <div class="page-btn">
        <a href="#" class="btn btn-primary text-white" data-bs-toggle="modal" data-bs-target="#add-artisan"><i class="ti ti-circle-plus me-1"></i>Ajouter Artisan</a>
      </div>
    </div>
    <!-- /artisan list -->
    <div class="card">
      <div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
        <div class="search-set">
          <div class="search-input">
            <input type="text" [(ngModel)]="searchTerm" (input)="onSearch()" placeholder="Rechercher..." style="padding: 0.45rem 2rem;" class="form-control" />
            <span class="btn-searchset"><i class="ti ti-search fs-14 feather-search"></i></span>
          </div>
        </div>
        <div class="d-flex table-dropdown my-xl-auto right-content align-items-center flex-wrap row-gap-3">
          <div class="dropdown">
            <a href="javascript:void(0);" class="dropdown-toggle btn btn-white btn-md d-inline-flex align-items-center" data-bs-toggle="dropdown">
              Statut
            </a>
            <ul class="dropdown-menu dropdown-menu-end p-3">
              <li>
                <a href="javascript:void(0);" class="dropdown-item rounded-1" (click)="filterStatus('')">Tous</a>
              </li>
              <li>
                <a href="javascript:void(0);" class="dropdown-item rounded-1" (click)="filterStatus('active')">Actif</a>
              </li>
<!--               <li>
                <a href="javascript:void(0);" class="dropdown-item rounded-1" (click)="filterStatus('inactive')">Inactif</a>
              </li> -->
              <li>
                <a href="javascript:void(0);" class="dropdown-item rounded-1" (click)="filterStatus('blacklisted')">Bloqué</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="card-body p-0">

        <div class="table-responsive">
          <table class="table datatable">
            <thead class="thead-light">
              <tr>
                <th>Nom</th>
                <th>Email</th>
                <th>Téléphone</th>
                <th>Statut</th>
                <th class="no-sort"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let person of filteredList">
                <ng-container *ngIf="person.type === 'artisan'">
                  <td>{{ person.name || (person.first_name + ' ' + person.last_name) }}</td>
                  <td>{{ person.email }}</td>
                  <td>{{ person.phone }}</td>
                    <td>
                    <span [ngClass]="{
                      'bg-success': person.status === 'active',
                      'bg-danger': person.status === 'inactive',
                      'bg-dark': person.status === 'blacklisted'
                      }"
                      class="d-inline-flex align-items-center p-1 pe-2 rounded-1 text-white fs-10">
                      <i class="ti ti-point-filled me-1 fs-11"></i>
                      {{
                      person.status === 'active' ? 'Actif' :
                      person.status === 'blacklisted' ? 'Blacklisted' :
                      'Inactif'
                      }}
                    </span>
                    </td>
                  <td class="d-flex">
                    <div class="edit-delete-action d-flex align-items-center">
                      <a class="me-2 p-2 d-flex align-items-center border rounded" href="#" (click)="editPerson(person)" data-bs-toggle="modal" data-bs-target="#edit-artisan">
                        <!-- Modifier -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                      </a>
                      <a class="p-2 d-flex align-items-center border rounded" href="javascript:void(0);" (click)="confirmDelete(person)" data-bs-toggle="modal" data-bs-target="#delete-modal">
                        <!-- Supprimer -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                      </a>
                    </div>
                  </td>
                </ng-container>
              </tr>
            </tbody>
          </table>
        </div>
                <!-- Pagination length selector -->
        <div class="dataTables_length mb-2" id="artisanTable_length">
          <label>
            Lignes par page
            <select name="artisanTable_length"
                    aria-controls="artisanTable"
                    class="form-select form-select-sm d-inline-block w-auto ms-2 me-2"
                    [(ngModel)]="pageSize"
                    (change)="onPageSizeChange($event)">
              <option *ngFor="let size of [10,25,50,100]" [value]="size">{{size}}</option>
            </select>
            entrées
          </label>
        </div>
        <!-- Pagination controls -->
        <div class="dataTables_paginate paging_simple_numbers " id="artisanTable_paginate">
          <ul class="pagination mb-0" style="margin: 2px 0 !important;
    white-space: nowrap !important;
    justify-content: flex-end !important;">
            <li class="paginate_button page-item previous"
                [class.disabled]="currentPage === 1"
                style="
    border: none;
    color: #646B72 !important;
    background-color: transparent !important;
    color: #646B72;
    width: 24px;
    height: 24px;
    border: 1px solid #E6EAED;
    border-radius: 50px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: 8px;
    margin: 0 5px;
"
                id="artisanTable_previous">
              <a class="page-link"
                 href="javascript:void(0);"
                 (click)="goToPage(currentPage - 1)"
               
                 [attr.aria-disabled]="currentPage === 1"
                 tabindex="-1">
                <i class="fa fa-angle-left"></i>
              </a>
            </li>
            <li *ngFor="let page of totalPagesArray; let i = index"
                class="paginate_button page-item"
                [class.active]="currentPage === (i+1)">
              <a class="page-link"
                 href="javascript:void(0);"
                 (click)="goToPage(i+1)">
                {{i+1}}
              </a>
            </li>
            <li class="paginate_button page-item next"
        style="
    border: none;
    color: #646B72 !important;
    background-color: transparent !important;
    color: #646B72;
    width: 24px;
    height: 24px;
    border: 1px solid #E6EAED;
    border-radius: 50px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: 8px;
    margin: 0 5px;
"
                [class.disabled]="currentPage === totalPages"
                id="artisanTable_next">
              <a class="page-link"
             

                 href="javascript:void(0);"
                 (click)="goToPage(currentPage + 1)"
                 [attr.aria-disabled]="currentPage === totalPages">
                <i class="fa fa-angle-right"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- /artisan list -->
  </div>
  <app-footer></app-footer>
</div>

<!-- Add Artisan -->
<div class="modal fade" id="add-artisan">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <div class="page-title">
          <h4>Ajouter Artisan</h4>
        </div>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Fermer">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form (ngSubmit)="addArtisan()" #addForm="ngForm">
        <div class="modal-body">
          <div class="row">
            <div class="col-lg-6 mb-3">
              <label class="form-label">Nom</label>
              <input type="text" class="form-control" [(ngModel)]="addModel.name" name="name" required>
            </div>
            <div class="col-lg-6 mb-3">
              <label class="form-label">Prénom</label>
              <input type="text" class="form-control" [(ngModel)]="addModel.first_name" name="first_name">
            </div>
            <div class="col-lg-6 mb-3">
              <label class="form-label">Nom de famille</label>
              <input type="text" class="form-control" [(ngModel)]="addModel.last_name" name="last_name">
            </div>
            <div class="col-lg-6 mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" [(ngModel)]="addModel.email" name="email" required>
            </div>
            <div class="col-lg-6 mb-3">
              <label class="form-label">Téléphone</label>
              <input type="text" class="form-control" [(ngModel)]="addModel.phone" name="phone">
            </div>
            <div class="col-lg-6 mb-3">
              <label class="form-label">Téléphone 2</label>
              <input type="text" class="form-control" [(ngModel)]="addModel.phone_2" name="phone_2">
            </div>
            <div class="col-lg-12 mb-3">
              <label class="form-label">Adresse</label>
              <textarea class="form-control" rows="3" [(ngModel)]="addModel.address" name="address"></textarea>
            </div>
            <div class="col-lg-12 mb-3">
              <label class="form-label">Adresse (complément)</label>
              <input type="text" class="form-control" [(ngModel)]="addModel.address_rest" name="address_rest">
            </div>
            <div class="col-lg-6 mb-3">
              <label class="form-label">Ville</label>
              <select class="form-select" [(ngModel)]="addModel.city" name="city">
                <option *ngFor="let city of franceCities" [value]="city">{{ city }}</option>
              </select>
            </div>
            <div class="col-lg-6 mb-3">
              <label class="form-label">Code Postal</label>
              <input type="text" class="form-control" [(ngModel)]="addModel.postal_code" name="postal_code">
            </div>

            <div class="col-lg-12 mb-3">
              <label class="form-label">Note</label>
              <textarea class="form-control" [(ngModel)]="addModel.note" name="note"></textarea>
            </div>
                        <div class="col-lg-12 mb-3">
              <div class="mb-0">
                <div class="status-toggle modal-status d-flex justify-content-between align-items-center">
                  <span class="status-label">Statut<span class="text-danger ms-1">*</span></span>
                  <input type="checkbox" id="add-active" class="check" [(ngModel)]="addModel.active" name="addActive">
                  <label for="add-active" class="checktoggle"></label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn me-2 btn-secondary fs-13 fw-medium p-2 px-3 shadow-none" data-bs-dismiss="modal">Annuler</button>
          <button type="submit" class="btn btn-primary fs-13 fw-medium p-2 px-3" [disabled]="addForm.invalid">Ajouter l'artisan</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- /Add Artisan -->

<!-- Edit Artisan -->
<div class="modal fade" id="edit-artisan">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="page-wrapper-new p-0">
        <div class="content">
          <div class="modal-header">
            <div class="page-title">
              <h4>Editer Artisan</h4>
            </div>
            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form (ngSubmit)="updateArtisan()" #editForm="ngForm">
            <div class="modal-body">
              <div class="row">
                <div class="col-lg-12 mb-3">
                  <label class="form-label">Nom de Société</label>
                  <input type="text" class="form-control" [(ngModel)]="editModel.name" name="name" required>
                </div>
                <div class="col-lg-6 mb-3">
                  <label class="form-label">Prénom</label>
                  <input type="text" class="form-control" [(ngModel)]="editModel.first_name" name="first_name">
                </div>
                <div class="col-lg-6 mb-3">
                  <label class="form-label">Nom de famille</label>
                  <input type="text" class="form-control" [(ngModel)]="editModel.last_name" name="last_name">
                </div>
                <div class="col-lg-12 mb-3">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control" [(ngModel)]="editModel.email" name="email" required>
                </div>
                <div class="col-lg-6 mb-3">
                  <label class="form-label">Téléphone</label>
                  <input type="text" class="form-control" [(ngModel)]="editModel.phone" name="phone">
                </div>
                <div class="col-lg-6 mb-3">
                  <label class="form-label">Téléphone 2</label>
                  <input type="text" class="form-control" [(ngModel)]="editModel.phone_2" name="phone_2">
                </div>
                <div class="col-lg-12 mb-3">
                  <label class="form-label">Adresse</label>
                  <textarea class="form-control" rows="3" [(ngModel)]="editModel.address" name="address"></textarea>
                </div>
                <div class="col-lg-12 mb-3">
                  <label class="form-label">Adresse (complément)</label>
                  <input type="text" class="form-control" [(ngModel)]="editModel.address_rest" name="address_rest">
                </div>
                <div class="col-lg-6 mb-3">
                  <label class="form-label">Ville</label>
                  <select class="form-select" [(ngModel)]="editModel.city" name="city">
                    <option *ngFor="let city of franceCities" [value]="city">{{ city }}</option>
                  </select>
                </div>
                <div class="col-lg-6 mb-3">
                  <label class="form-label">Code Postal</label>
                  <input type="text" class="form-control" [(ngModel)]="editModel.postal_code" name="postal_code">
                </div>

                <div class="col-lg-12 mb-3">
                  <label class="form-label">Note</label>
                  <textarea class="form-control" [(ngModel)]="editModel.note" name="note"></textarea>
                </div>
              </div>
                              <div class="col-lg-12 mb-3">
                  <div class="mb-0">
                    <div class="status-toggle modal-status d-flex justify-content-between align-items-center">
                      <span class="status-label">Statut<span class="text-danger ms-1">*</span></span>
                      <input
                        type="checkbox"
                        id="edit-active"
                        class="check"
                        [ngModel]="editModel.status === 'active'"
                        (ngModelChange)="editModel.status = $event ? 'active' : 'blacklisted'"
                        name="editActive">
                      <label for="edit-active" class="checktoggle"></label>
                    </div>
                  </div>
                </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn me-2 btn-secondary fs-13 fw-medium p-2 px-3 shadow-none" data-bs-dismiss="modal">Annuler</button>
              <button type="submit" class="btn btn-primary fs-13 fw-medium p-2 px-3" [disabled]="editForm.invalid">Enregistrer</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- /Edit Artisan -->

<!-- delete modal -->
<div class="modal fade" id="delete-modal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="page-wrapper-new p-0">
        <div class="content p-5 px-3 text-center">
          <span class="rounded-circle d-inline-flex p-2 bg-danger-transparent mb-2"><i class="ti ti-trash fs-24 text-danger"></i></span>
          <h4 class="fs-20 fw-bold mb-2 mt-1">Supprimer l'utilisateur</h4>
          <p class="mb-0 fs-16">Êtes-vous sûr de vouloir supprimer cet utilisateur&nbsp;?</p>
          <button type="button" class="btn me-2 btn-secondary fs-13 fw-medium p-2 px-3 shadow-none" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary fs-13 fw-medium p-2 px-3" (click)="deleteArtisan()">Oui, supprimer</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- /Edit Artisan -->

<!-- /Edit Artisan -->

<!-- delete modal -->
 <div class="modal fade" id="delete-modal">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="page-wrapper-new p-0">
				<div class="content p-5 px-3 text-center">
						<span class="rounded-circle d-inline-flex p-2 bg-danger-transparent mb-2"><i class="ti ti-trash fs-24 text-danger"></i></span>
						<h4 class="fs-20 fw-bold mb-2 mt-1">Supprimer l'utilisateur</h4>
						<p class="mb-0 fs-16">Êtes-vous sûr de vouloir supprimer cet utilisateur&nbsp;?</p>
						<div class="modal-footer-btn mt-3 d-flex justify-content-center">
							<button type="button" class="btn me-2 btn-secondary fs-13 fw-medium p-2 px-3 shadow-none" data-bs-dismiss="modal">Annuler</button>
							<button type="submit" class="btn btn-primary fs-13 fw-medium p-2 px-3">Oui, supprimer</button>
						</div>						
				</div>
			</div>
		</div>
	</div>
</div>


